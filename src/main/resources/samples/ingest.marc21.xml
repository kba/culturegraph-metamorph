<?xml version="1.0" encoding="UTF-8"?>
<metamorph xmlns="http://www.culturegraph.org/metamorph"
	version="2">
	<meta>
		<name>Marc21 to PropertyRecord</name>
	</meta>

	<rules>
		<combine name="cg:typeOfWork" value="${first}${second}">
			<data source="level" name="first" />
			<data source="multipart" name="second" />
			<postprocess>
				<lookup in="workListLimited" />
			</postprocess>
		</combine>

		<data source="multipart" name="cg:resourceType">
			<lookup in="resourceList" />
		</data>

		<data source="level" name="cg:typeOfConWork">
			<lookup in="workListContinuousWorks" />
		</data>

		<data source="001" name="cg:sourceRecordId" />

		<data source="005" name="xbib:lastModifiedByInstitution" />

		<data source="007" name="dcterms:format">
		</data>

		<data source="008" name="cg:countryCodeMarc">
			<regexp match="^(.{15})(\w{2,3})(.*)" format="${2}" />
		</data>

		<data source="008" name="dcterms:language">
			<regexp match="^(.{35})(\w{2,3})(.*)" format="${2}" />
		</data>

		<data source="010  .a" name="xbib:identifierAuthorityLOC" />

		<data source="013  .a" name="xbib:identifierPatent" />

		<combine name="${name}" value="${value}" reset="true">
			<data source="0167 .2" name="name">
				<lookup in="prefixLookup016" />
			</data>
			<data source="0167 .a" name="value" />
		</combine>

		<!-- cause BSZ uses wrong indicators/subfields-combination -->
		<combine name="${name}" value="${value}"
			reset="true">
			<data source="016  .a" name="name">
				<regexp match="^\(.*\)" />
				<lookup in="prefixLookup016" />
			</data>
			<data source="016  .a" name="value">
				<regexp match="^\(.*\)((.*))" format="${1}" />
			</data>
		</combine>


		<data source="020  .a" name="xbib:identifierAuthorityISBN">
			<isbn to="isbn13" />
		</data>

		<data source="022  .a" name="xbib:identifierAuthorityISSN" />

		<data source="0242 .a" name="xbib:identifierAuthorityISMN" />

		<data source="0243 .a" name="xbib:identifierAuthorityEAN" />

		<combine name="${name}" value="${value}"
			reset="true">
			<data source="0247 .2" name="name">
				<lookup in="doiList" />
			</data>
			<data source="0247 .a" name="value" />
		</combine>

		<combine name="${name}" value="${value}"
			reset="true">
			<data source="0248 .a" name="name">
				<regexp match="^VD.{2}" />
				<lookup in="vdList" />
			</data>
			<data source="0248 .a" name="value">
				<regexp match="(^VD.{2})(.*)" format="${1}" />
			</data>
		</combine>

		<data source="027  .a" name="xbib:identifierAuthorityISRN" />

		<group name="xbib:fingerprint">
			<data source="026  .a" />
			<data source="026  .b" />
		</group>

		<group name="xbib:identifierAudioPublisher">
			<data source="02852.a" />
			<data source="02852.b" />
		</group>

		<combine name="${name}" value="${value}"
			reset="true">
			<data source="035  .a" name="name">
				<regexp match="^\(.*\)" />
				<lookup in="prefixLookup035" />
			</data>
			<data source="035  .a" name="value">
				<regexp match="^\(.*\)((.*))" format="${1}" />
			</data>
		</combine>

		<!-- <data source="035 .a" name="xbib:identifierAuthorityEKIorOCLC" /> -->

		<group name="xbib:originLanguage">
			<data source="041  .h" />
			<data source="041 7.h" />
			<data source="041 7.2" />
		</group>

		<group name="dcterms:language">
			<data source="041 7.a" />
			<data source="041 7.2" />
		</group>

		<data source="044  .c" name="cg:countryCodeIso" />

		<data source="088  .a" name="xbib:identifierReport" />

		<group name="dcterms:creator">
			<data source="1001 .a" />
			<data source="1001 .c" />
		</group>

		<data source="090  .f" name="cg:typeOfWork">
			<lookup in="workListField90" />
		</data>

		<data source="1001 .0" name="xbib:creatorDNBGND">
			<regexp match="^\(DE-588a\)((.*))" format="${1}" />
		</data>

		<group name="rdaGr2:identifierForTheCorporateBody">
			<data source="1102 .0" />
			<data source="1100 .0" />
			<data source="1101 .0" />
		</group>

		<group name="gnd:preferredNameForTheCorporateBody">
			<data source="1102 .a" />
			<data source="1100 .a" />
			<data source="1101 .a" />
		</group>

		<group name="@dcterms:title">
			<data source="24500.a" />
			<data source="24503.a" />
			<data source="24504.a" />
			<data source="24510.a" />
			<data source="24512.a" />
			<data source="24514.a" />
		</group>

		<data source="@dcterms:title" name="dcterms:title">
			<normalize-utf8 />
		</data>

		<group name="@cg:additionToTitle">
			<data source="24500.b" />
			<data source="24503.b" />
			<data source="24504.b" />
			<data source="24510.b" />
			<data source="24512.b" />
			<data source="24514.b" />
		</group>

		<data source="@cg:additionToTitle" name="cg:additionToTitle">
			<normalize-utf8 />
		</data>

		<group name="dcterms:volume">
			<data source="245 0.n" />
			<data source="245 4.n" />
			<data source="24500.n" />
			<data source="24503.n" />
			<data source="24504.n" />
			<data source="24510.n" />
			<data source="24512.n" />
			<data source="24514.n" />
		</group>

		<group name="cg:edition">
			<data source="250  .a" />
			<!-- <data source="250 .6" /> <data source="250 .8" /> -->
		</group>

		<group name="xbib:titleVolume">
			<data source="24500.p" />
			<data source="24503.p" />
			<data source="24504.p" />
			<data source="24510.p" />
			<data source="24512.p" />
			<data source="24514.p" />
		</group>

		<group name="@xbib:publicationPlace">
			<data source="260  .a" />
			<data source="2603 .a" />
		</group>

		<data source="@xbib:publicationPlace" name="xbib:publicationPlace">
			<normalize-utf8 />
		</data>

		<group name="@xbib:publisherName">
			<data source="260  .b" />
			<data source="2603 .b" />
		</group>

		<data source="@xbib:publisherName" name="xbib:publisherName">
			<normalize-utf8 />
		</data>

		<group name="dcterms:issued">
			<data source="260  .c" />
			<data source="2603 .c" />
		</group>

		<data source="300  .a" name="dcterms:extends" />

		<data source="502  .o" name="xbib:identifierUniversityScript" />

		<!-- <data source="7001 .0" name="xbib:creatorDNBGNDnebeneintragung"> <regexp 
			match="^\(DE-588a\)((.*))" format="${1}" /> </data> <data source="7102 .0" 
			name="rdaGr2:identifierForTheCorporateBodynebeneintragung"> <regexp match="^\(DE-588b\)((.*))" 
			format="${1}" /> </data> -->

		<group name="cg:broaderWorkId">
			<data source="773  .w" />
			<data source="7730 .w" />
			<data source="7731 .w" />
			<data source="77318.w" />
			<data source="77308.w" />
			<data source="4901 .x" />
			<data source="4900 .x" />
			<data source="830 0.x" />
		</group>

		<group name="@cg:broaderWorkTitle">
			<data source="4901 .a" />
			<data source="4900 .a" />
			<data source="830 0.a" />
		</group>

		<data source="@cg:broaderWorkTitle" name="cg:broaderWorkTitle">
			<normalize-utf8 />
		</data>

		<group name="cg:broaderWorkVolume">
			<data source="4901 .v" />
			<data source="4900 .v" />
			<data source="830 0.v" />
		</group>
	</rules>
	<maps>

		<map name="prefixLookup016">
			<entry name="DE-101" value="xbib:identifierAuthorityDNB" />
			<entry name="(DE-600)" value="xbib:identifierAuthorityZDB" />
			<entry name="Uk" value="xbib:identifierAuthorityBNB" />
			<entry name="ItFiC" value="xbib:identifierAuthorityCasaliniLibri" />
			<entry name="FrPBN" value="xbib:identifierAuthorityBNF" />
			<entry name="(OCoLC)" value="xbib:identifierAuthorityOCLC" />
			<entry name="(DE-599)" value="xbib:identifierAuthorityEKI" />
			<!-- <entry name="(XXXxUND)" value="EKI-fakePrefix" /> -->
		</map>

		<map name="prefixLookup035" default="undefinedField035">
			<entry name="(OCoLC)" value="xbib:identifierAuthorityOCLC" />
			<entry name="(DE-599)" value="xbib:identifierAuthorityEKI" />
			<entry name="(OBV)" value="xbib:identifierAuthorityOBV" />
			<entry name="(XXXxUND)" value="xbib:identifierAuthorityEKIincorrect" />
		</map>

		<map name="doiList" default="undefinedDoi">
			<entry name="doi" value="xbib:uniformResourceDoi" />
			<entry name="urn" value="xbib:uniformResourceName" />
			<entry name="handle" value="xbib:uniformResourceHandle" />
		</map>

		<map name="vdList" default="undefinedVd">
			<entry name="VD16" value="xbib:identifierVD16" />
			<entry name="VD17" value="xbib:identifierVD17" />
			<entry name="VD18" value="xbib:identifierVD18" />
		</map>

		<map name="workListLimited" default="undefinedWork">
			<entry name="a " value="dependentWork" />
			<entry name="m " value="independentWork" />
			<entry name="ma" value="severalVolumesWorkLimited" />
			<entry name="mb" value="singleVolumeWorkPartOfBigger" />
			<entry name="mc" value="partWithDependentTitle" />
		</map>

		<map name="workListContinuousWorks">
			<entry name="d" value="dependentConWork" />
			<entry name="s" value="journalSeriesNewspaper" />
		</map>

		<map name="workListField90">
			<entry name="a" value="continuationWork" />
			<entry name="b" value="severalVolWorkLtdPartOfBigger" />
		</map>

		<map name="resourceList">
			<entry name=" " value="multipart_notSpecified" />
			<entry name="a" value="multipart_Kopfsatz" />
			<entry name="b" value="multipart_Stuecktitel" />
			<entry name="c" value="multipart_Bandauffuehrung" />
		</map>
	</maps>
</metamorph>	